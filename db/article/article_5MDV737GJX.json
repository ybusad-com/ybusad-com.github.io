{"code":0,"msg":"ok","data":{"article":{"authorCode":"admin","authorName":"孙天骁","classify":"技术类","content":"<p style=\"text-indent: 2em;\">最近练习Webpack和Vue组件，看了别人学习js时的经历，我觉得自己应该试试怎样写一个贪食蛇小游戏出来。</p><p style=\"text-indent: 2em;\">游戏编程嘛，因为我数学之类的不太好，所以一直对这种逻辑性有强烈要求的程序有抵触性的。之前也不是没写过游戏，不过都是逻辑极其简单，趣味性也很差的游戏。</p><p style=\"text-indent: 2em;\"><img src=\"/article%2F150738298510.png\" title=\"article/1507379435.png\" alt=\"blob.png\"></p><p style=\"text-indent: 2em;\">效果是这样的，一个Canvas，一条蛇，随机出现果子。果子是圆形的。</p><p style=\"text-indent: 2em;\"><a href=\"/\" target=\"_blank\">http://snakegame.ybusad.com/</a></p><p style=\"text-indent: 2em;\"><br></p><p style=\"text-indent: 2em;\">之前觉得Webpack之类的打包工具很神奇，入门了之后发现确实很神奇。为了能让代码多一些优雅，所以我需要：</p><p style=\"text-indent: 2em;\">Babel（ES6转ES5），LESS（更容易写CSS的方法），然后用这些做Vue单文件组件。</p><p style=\"text-indent: 2em;\">Vue单文件组件是在Vue工程化开发时很好用的一个东西，它可以把一个组件有关的HTML模板、样式、脚本写在一个文件里。</p><p style=\"text-indent: 2em;\"><br></p><p style=\"text-indent: 2em;\">我先说说这个贪食蛇的逻辑。</p><p style=\"text-indent: 2em;\">首先是一个游戏界面的画布。将画布分成了许许多多格子，然后以这些格子为基本单位渲染游戏界面。</p><p style=\"text-indent: 2em;\">在我的代码里，把描述各格子状态的数据结构（二维数组）叫做map。用0-4五个状态代表空白、水果、蛇头、蛇身、障碍物（墙）。但是在这个版本里，墙的状态没有用到。只是不允许跨越四周，就相当于四周围了圈墙了。通过一个state函数来获取/设置各格（下文叫各点）的状态。</p><p style=\"text-indent: 2em;\">我还需要一个数组，存储蛇各点的坐标。蛇前进的时候想法很简单，蛇头unshift，蛇尾pop。如果吃到果子了，蛇尾就不需要pop，这样蛇就长身子了。</p><p style=\"text-indent: 2em;\">需要一个timer，每隔0.25s更新状态。这个时间是我反复推敲得来的，我觉得在我这个宽48格，高32格的游戏场景下最合适。</p><p style=\"text-indent: 2em;\">需要监听方向键的变化。按方向键时执行两个操作：1.如果不是让它180度旋转，就按方向转向。2.计时器提前执行下一帧，这样1是可以让蛇头即时响应，2是有一个按住加速的效果。</p><p style=\"text-indent: 2em;\">存储当前蛇前进的方向，每一帧计算蛇头的下一个位置，如果是果子，当然是“吃掉”，随机生成下一个果子的位置。如果是蛇身或者周围，那么游戏结束。</p><p style=\"text-indent: 2em;\"><br></p><p style=\"text-indent: 2em;\">我在全局的样式上，令每个元素的margin和padding都是0，并且box-sizing为border-box。即把元素的边框和内边距都算在宽度里面，这样方便布局，我很喜欢这样做。</p><p style=\"text-indent: 2em;\">然后我就贴上这个Vue组件的代码：（这里编辑器不太识别，我粘在GitHub上好了）</p><p style=\"text-indent: 2em;\"><a href=\"https://github.com/sunkint/CodePaste/blob/master/snake.md\" _src=\"https://github.com/sunkint/CodePaste/blob/master/snake.md\">https://github.com/sunkint/CodePaste/blob/master/snake.md</a> </p><p style=\"text-indent: 2em;\"><br></p><p style=\"text-indent: 2em;\">在整个开发过程中（包括之前的配置）其实还是踩了不少坑的。</p><p style=\"text-indent: 2em;\">我用的babel包全称叫做babel-preset-env，官方说可以根据配置来决定需要向前兼容多少浏览器！</p><p style=\"text-indent: 2em;\">所以必须要配置！在工程目录下建一个.babelrc文件，我的配置是这样的。</p><pre class=\"brush:plain;toolbar:false\">{\n&nbsp;&nbsp;\"presets\":&nbsp;[\n&nbsp;&nbsp;&nbsp;&nbsp;[\"env\",&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\"modules\":&nbsp;false,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\"targets\":&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\"browsers\":&nbsp;[\"&gt;&nbsp;1%\",&nbsp;\"last&nbsp;2&nbsp;versions\",&nbsp;\"not&nbsp;ie&nbsp;&lt;=&nbsp;8\"]\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}]\n&nbsp;&nbsp;]\n}\n</pre><p style=\"text-indent: 2em;\">这样至少国产主流浏览器应该是可以支持了。我这个搜狗高速浏览器还在用着chrome49的内核...打开github都提醒我说不再支持。。</p><p style=\"text-indent: 2em;\">剩下的我还要花时间去深究。我的webpack和npm的配置一部分是从vue-cli上抄的。现在实现了调试模式和生产模式有不同的打包选项。其实熟悉了的话还是挺好用的。</p><p style=\"text-indent: 2em;\">调试模式下还有个叫webpack-dev-server的包，可以热更新，基本上F5都省了，开着的时候在代码上做的改变会实时反映在浏览器上，确实很方便。</p><p style=\"text-indent: 2em;\">其他的，以后再说吧。</p><p style=\"text-indent: 2em;\"><br></p>","createTime":"2017-10-07 21:30:51","customCoverKey":"","id":211,"isGood":false,"isTop":false,"publicState":0,"replyCount":0,"state":0,"tags":["程序设计"],"title":"谈谈我这个贪食蛇游戏的制作","urlCode":"5MDV737GJX","viewCount":309,"viewGroup":-1,"authPassed":true},"author":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}}}