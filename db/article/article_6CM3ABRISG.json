{"code":0,"msg":"ok","data":{"article":{"authorCode":"admin","authorName":"孙天骁","classify":"技术类","content":"<p style=\"text-indent: 2em;\">为了交我们安卓移动端开发选修课的作业，这几天赶制出的APP。<br/></p><p style=\"text-indent: 2em;\">是我的第五个安卓应用程序了呢。</p><p style=\"text-indent: 2em;\">虽然是交作业，但是也是测试了很多新技术。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">我新建了一个Service，在里面播放音乐，写代码跟主Activity通信，并在主Activity有一个seekbar（滑块）可以显示和调整播放进度。</p><p style=\"text-indent: 2em;\">我又测试了跟我网站交换数据的步骤（可能为以后的我网站更深的应用做铺垫），另外，我还做了一个仅包含WebView（浏览器控件）的Activity用来展示我网站的网页。</p><p style=\"text-indent: 2em;\">因为这个项目从一开始就被设计要求开源，我也一扫以前写Java的臃肿不堪，从开始就整理好了整个APP的代码结构，并用了很多的注释。</p><p style=\"text-indent: 2em;\">其中的很多代码不知道调试了多少次才成功- -历尽艰辛啊。</p><p style=\"text-indent: 2em;\">工程+最后编译好的apk：</p><p style=\"text-indent: 2em;\"><a href=\"http://pan.baidu.com/s/1kTWBmdD\" _src=\"http://pan.baidu.com/s/1kTWBmdD\">http://pan.baidu.com/s/1kTWBmdD</a> </p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">简单说一下我遇到困难的几个点吧：</p><p style=\"text-indent: 2em;\"><span style=\"font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;\"><strong><span style=\"font-size: 18px;\">1.Activity与Service的通信连接，不知道参考了多少资料才弄好</span></strong><span style=\"font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;\">（狗血的是最后我也不知道它为啥能正常运行了）</span></span><br/></p><p style=\"text-indent: 2em;\">在Activity的onCreate事件里写这样的代码（我只贴关键代码）：<br/></p><pre class=\"brush:java;toolbar:false\">mConnection&nbsp;=&nbsp;new&nbsp;ServiceConnection()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;@Override&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onServiceConnected(ComponentName&nbsp;className,&nbsp;IBinder&nbsp;service)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LocalBinder&nbsp;binder&nbsp;=&nbsp;(LocalBinder)&nbsp;service;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mService&nbsp;=&nbsp;binder.getService();&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;@Override&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onServiceDisconnected(ComponentName&nbsp;arg0)&nbsp;{}\n\n};\n\n//开始音乐的Service\nIntent&nbsp;intent&nbsp;=&nbsp;new&nbsp;Intent(this,&nbsp;MusicServer.class);&nbsp;&nbsp;\nbindService(intent,&nbsp;mConnection,&nbsp;Context.BIND_AUTO_CREATE);</pre><p style=\"text-indent: 2em;\">用来建立连接开始服务。</p><p style=\"text-indent: 2em;\">同时在服务里又有这样的代码响应：</p><pre class=\"brush:java;toolbar:false\">public&nbsp;class&nbsp;LocalBinder&nbsp;extends&nbsp;Binder&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;MusicServer&nbsp;getService()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MusicServer.this;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\n@Override&nbsp;&nbsp;\npublic&nbsp;IBinder&nbsp;onBind(Intent&nbsp;intent)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;LocalBinder();\n}</pre><p style=\"text-indent: 2em;\">这样的话我在Activity里就可以靠访问mService来访问整个MusicService类了。。在这个服务类里写好一些public的属性方法就可以。</p><p style=\"text-indent: 2em;\">其中有一个叫player的MediaPlayer对象用来播放音乐。</p><p style=\"text-indent: 2em;\"><strong><span style=\"font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 18px;\">2.获取工程asset目录下的音乐资源文件用来播放</span></strong><span style=\"font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;\">，这个也不知道参考了多少资料，尝试了多久才弄好。</span></p><pre class=\"brush:java;toolbar:false\">//从资源文件夹中加载音频文件\nAssetFileDescriptor&nbsp;afd&nbsp;=&nbsp;getAssets().openFd(&quot;mp3/English.mp3&quot;);\nFileDescriptor&nbsp;fd&nbsp;=&nbsp;afd.getFileDescriptor();\n\n//准备播放音乐\nplayer.setDataSource(fd,&nbsp;afd.getStartOffset(),&nbsp;afd.getLength());\nplayer.prepare();</pre><p style=\"text-indent: 2em;\">再调用player.start();就可以播放音乐了。音乐是放在assets/mp3/目录下的。之前因为没有实例化player的对象，也折腾半天才发觉。</p><p style=\"text-indent: 2em;\">别看最后只有四行代码啊啊！网上的东西参差不齐，不知道尝试各种代码各种写法多少遍才搞成的！</p><p style=\"text-indent: 2em;\">这四行代码还要求必须在try结构体里才可以，捕获一下可能发生的错误。</p><p style=\"text-indent: 2em;\">另外我还用了Runnable接口新建线程，更安全而且代码更整洁。用一个hander再靠Message和主线程通信。</p><pre class=\"brush:java;toolbar:false\">class&nbsp;MyThread&nbsp;implements&nbsp;Runnable&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;@Override&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;{&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//这里写需要在线程里运行的代码\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//如果需要再传一个message\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;m&nbsp;=&nbsp;new&nbsp;Message();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m.what&nbsp;=&nbsp;0;&nbsp;//状态码\n    m.obj&nbsp;=&nbsp;&quot;...&quot;;&nbsp;//消息内容\n    handler.sendMessage(m);&nbsp;//靠一个Handler类型的handler进行线程间通信\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}</pre><p style=\"text-indent: 2em;\">handler里再写代码捕获消息就可以了。</p><pre class=\"brush:java;toolbar:false\">handler&nbsp;=&nbsp;new&nbsp;Handler(){\n&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;handleMessage(Message&nbsp;msg)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//msg对象在这里可以获得\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\n//这两行代码就是开始线程的\nMyThread&nbsp;t&nbsp;=&nbsp;new&nbsp;MyThread();\nnew&nbsp;Thread(t).start();</pre><p style=\"text-indent: 2em;\">是不是很方便呢...本来有参考别人做的一个代码，写着写着觉得他的一些做法难以理解，就用自己的方式实现了，到最后只参考了它的极少部分逻辑..<br/></p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">就分享这么多了，我要玩去了。。今天考完四级了，感觉还可以吧，，没想象的那么难，不过也不简单。</p><p style=\"text-indent: 2em;\">宋世鑫今天下午考完六级了。</p>","createTime":"2015-12-19 21:00:47","customCoverKey":"","id":106,"isGood":false,"isTop":false,"publicState":0,"replyCount":0,"state":0,"tags":["安卓","编程"],"title":"孙天骁的第五个安卓应用程序“梦之典”隆重开源","urlCode":"6CM3ABRISG","viewCount":728,"viewGroup":-1,"authPassed":true},"author":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}}}