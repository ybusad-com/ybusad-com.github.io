{"code":0,"msg":"ok","data":{"article":{"authorCode":"admin","authorName":"孙天骁","classify":"技术类","content":"<p style=\"text-indent: 2em;\">今天（2017年7月14日），对于本网站来说，又是一个里程碑式的日子。经过长时间的规划和适配，组成骁之屋的所有主要域名都启用了https协议。<br/></p><p style=\"text-indent: 2em;\">https的全称为Hyper Text Transfer Protocol over Secure Socket Layer（HTTP over SSL），是http协议的安全版本。http协议以明文传输信息，容易被第三方窃听/篡改。而https协议传输的网页等内容会被进行高强度加密，杜绝了信息传输过程中的窃听/篡改的行为。https协议过去仅被银行等金融机构的网站采用，但近年来随着设备计算能力的提高，大家网络安全意识的加强，证书签发的成本降低，以及以Google为首的互联网公司的推动下，不少非金融机构网站和中小型网站也已经使用了https协议。</p><p style=\"text-indent: 2em;\">我最早发现https开始民用化是在2015年初，在那之前我以为https就是银行和支付宝才使用的高大上的玩意。那时我发现技术帝小毅毅的个人网站率先应用了全站https。浏览他个人网站的时候会在地址栏显示一个绿色的锁头。于是我那时去查怎么给网站应用https协议，没想到的是我搜到了https协议的工作原理，吓了我一跳，我以为我需要实现工作原理的所有内容才能令网站支持https。而当时https并没有特别普及，所有我就没有进一步考虑。<br/></p><p style=\"text-indent: 2em;\">后来的时间里，随着我对网站技术/Linux的不断深入学习，以及拥有了自己的阿里云服务器，我才逐渐意识到https并没有我想象的那么困难。最近一年多以来随着Google等公司的大力推动，很多常见的网站都应用了https。百度从百度搜索开始应用了https协议，逐渐百度贴吧和其他一些百度产品也都上了https协议。知乎在去年年底启动了全站https。魅族官网老早以前就是http和https并存，现在也转为全部https。小米官网上个月也启动了全站https。更不要说淘宝京东这些购物站，还有网络技术服务有关的网站，都早早地启用了全站https，来保证通讯的安全和防止密码等隐私的泄露。</p><p style=\"text-indent: 2em;\">但是说给网站应用https，也不是部署个证书就完了。<strong>在https的网站中无法加载使用http协议的资源</strong>，所以要对网站的许多地方进行调整，这也是百度也没有一下子全部启动https的原因。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">下面我谈一下我是怎么给骁之屋应用https的。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">在年初的时候我就为我的校长基金项目——砾风在线编译器站应用了https。这个网站的特点是结构简单，也不需要引用外部资源。在服务器方面则是纯粹的LAMP，所以这个理论上是好办的。我读了一些国外的教程和文章，使用了certbot（免费证书提供商Let&#39;s encrypt的证书机器人程序）完成了从申请到部署的整个过程。</p><p style=\"text-indent: 2em;\"><a href=\"https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04\" _src=\"https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04\">https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04</a></p><p style=\"text-indent: 2em;\"><span style=\"text-indent: 32px;\">Let&#39;s encrypt是一个致力于全网向https过渡的互联网安全组织，它的证书是免费的，而且得到了大多数浏览器的支持。但是使用Let&#39;s encrypt也有一些限制，不提供界面，必须通过一些Unix指令来申请证书。以及证书的有效期只有九十天，到期之前需要续签或者重新签。这些限制也曾经令我犹豫过，但是我后来发现，即使有这些限制，Let&#39;s encrypt也是我用过的最方便的证书机构，它是开源的，自助申请颁发的，也不需要你上报身份证等各种身份信息和联系方式，只需要一个email就好。熟练之后签发证书是很快的。</span></p><p style=\"text-indent: 2em;\"><span style=\"text-indent: 32px;\">在骁之屋上，我使用acme.sh签发的证书。这个有中文文档，还是很浅显易懂的。</span></p><p style=\"text-indent: 2em;\"><span style=\"text-indent: 32px;\"><a href=\"https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E\" _src=\"https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E\">https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E</a> </span></p><p style=\"text-indent: 2em;\">但是上面说过，https的网站中无法加载使用http协议的资源。本网站依赖七牛云CDN运行，所以必须让七牛云加速的域名首先支持https。还好，七牛云今年允许了较短有效期的https证书的配置。以前的时候证书有效期不能少于半年，再以前的时候使用https时甚至不能有自定义的加速域名（那个时候小毅毅就用上了https，它的网站当时也依赖七牛云）。acme.sh给我签发的证书是一个key文件和三个cer文件，七牛云上写的也很明白，于是我一次就成功了。并在昨天把网站大多数对七牛云的引用都换成了https。<br/></p><p style=\"text-indent: 2em;\">然后就来修改骁之屋主体的网站，我用了一个按量付费的云主机来调试。排查各网页引用的资源。本网站基于Centos+WDCP，现在使用了Centos 7，WDCP也升级到了最新版本。最新版本的WDCP是支持一键配置https的，我也试了，但是发现并不好用（满足不了“全站”这个要求，组成骁之屋的域名不止一个）。所以才自己操作的。但是后来我又遇到一个坑，我网站需要的证书格式是pem（至少WDCP需要pem格式的证书给网站部署https），但是脚本生成的证书是cer类型的。我找到一个在线转换的服务，把cer和key转换成了pem格式。这才部署成功。</p><p style=\"text-indent: 2em;\"><img src=\"/article%2F1500014996.png\" title=\"article/1500014996.png\" alt=\"blob.png\"/></p><p style=\"text-indent: 2em;\">所以现在我网站的域名前面也有绿锁头了，在用户登录的时候浏览器也不会提示不安全了。如果发现网站某个页面没有绿锁头，多半是这个页面不小心尝试加载了http的资源（会被浏览器阻止），如果发现骁之屋的某个页面运行有bug，欢迎向我提出哦！非常感谢。</p>","createTime":"2017-07-14 14:52:09","customCoverKey":"","id":200,"isGood":true,"isTop":false,"publicState":0,"replyCount":3,"state":0,"tags":["网站","网站测试","网站开发","骁之屋"],"title":"骁之屋正式启用全站https！","urlCode":"CQGJ62ISXZ","viewCount":1069,"viewGroup":-1,"authPassed":true},"author":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}}}