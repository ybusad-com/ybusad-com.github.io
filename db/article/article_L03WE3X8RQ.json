{"code":0,"msg":"ok","data":{"article":{"authorCode":"admin","authorName":"孙天骁","classify":"技术类","content":"<p style=\"text-indent: 2em;\">这几天有一件事情让我特别兴奋，那就是我耗时一个月打造的天骁随记Android客户端v6.0终于编写完成。</p><p style=\"text-indent: 2em;\">在我自豪地介绍它之前，我先介绍一下<span style=\"text-decoration: underline;\">什么是天骁随记</span>吧。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">天骁随记是我网站的一个重要的功能，是我为了能够随时随地记录生活和分享感悟而打造的。我在2013年初有了第一部运行Android的智能手机，智能手机玩什么？玩的就是多姿多彩的应用和无处不在的互联网体验。在那个时候我已经开始建设我自己的个人网站，那时的我就想，我能不能在自己手机上搞出一个应用，可以随时随地把我想说的话发送到网站上？所以，在2013年5月底，我的想法终于被我变成了现实，所以每天发随记从那天开始变成了我生活的一部分。我的好多想法，处境，都被我第一时间用随记客户端发送到了网站上。所以，作为一个随身记录个人网站，随记系统起到了一个至关重要的作用，也为后来打造的百科系统奠定了基础。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">在去年几乎同时发布的天骁随记客户端v5以及后来的v5.1-5.3上，我成功实现了天骁随记的新版设置页。主要增加的功能有：备用随记服务器支持、自动获取百科排行榜支持、以及UI布局优化和主屏幕快速输入列表。天骁随记的快速输入功能是在14年年末做的v4版本的新增功能，主要是维护一个我经常提及的小伙伴的名字的列表，方便我写随记时输入。本来我是做在应用的选项菜单里的，在v5.1版本上，我重新绘制了主界面的UI，将快速输入列表的前九项以九宫格的形式放在了我写随记的文本框上方。这个时候，两种快速输入列表是共存的，并可以在设置页控制主屏幕快速输入列表的显示与否。而在v6中，快速输入便只有主屏幕快速输入列表一种形式，而且不支持隐藏。这是我对这种设计易用性的肯定，也是我做出的一个合理的取舍。</p><p style=\"text-indent: 2em;\">在v6版本上，我还做了一个比较大的取舍，把对备用随记服务器的支持取消了。因为我找到了更优雅的解决方案。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">毫无疑问，v6版本是天骁随记Android客户端诞生以来最大的一次更新。首先在设计和开发上，较前代有了巨大的调整。</p><p style=\"text-indent: 2em;\">这一版的天骁随记客户端是完全推倒重写的。</p><p style=\"text-indent: 2em;\">这一版的天骁随记客户端是用Android Studio创作的，而前代版本均由eclipse创作。</p><p style=\"text-indent: 2em;\">在这一版的天骁随记客户端上，我开始追求界面的美观：设计尽量遵从Google提倡的Material Design，并根据我个人的喜好做出一些调整。</p><p style=\"text-indent: 2em;\">在这一版的天骁随记客户端上，我开始追求功能的完备：针对我之前在发随记时遇到的一些痛点，在客户端上我一一做出了合理的支持。</p><p style=\"text-indent: 2em;\">从这一版的天骁随记客户端开始，它不仅仅可用于发随记，也可用于看随记、删改随记。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">我使用的Android设备是小米公司生产的小米手机5高配版，运行MIUI8开发版，基于Android7.0（API 24），来看看主界面长什么样子。<br/></p><p style=\"text-indent: 2em;\"><img src=\"/article/1482591489_9957.png\" title=\"1482591489_9957.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">作为对比，我再发一张之前使用的v5.3的首页截图：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482591941_7837.png\" title=\"1482591941_7837.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">新版客户端的配色变冷了，“边框”变窄了，提交按钮“消失”了，地点选择“消失了”，那个从v1就有的是否公开的复选框也不见了。他们去哪里了呢？</p><p style=\"text-indent: 2em;\">我将提交按钮整合到了工具栏上，右上角的纸飞机按钮就是惯常使用的发送按钮。设计在这里有一个好处，那就是需要按提交按钮时不需要先对键盘喊一声“退下！”，无形之中加快了随记发送速度。</p><p style=\"text-indent: 2em;\">而地点选择，也被我做到了工具栏上，而且换了一种形式。至于如何发送私有的随记，看我轻触右下角的加号按钮：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482592474_3928.png\" title=\"1482592474_3928.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">哈哈，藏在这里了。这个是我做的一个仿知乎的动画效果，那个浮动按钮会旋转为一个×号，菜单会弹出，背景会变淡。轻触变淡的区域或者按×号都可以收回弹出的菜单。按下“统计当前随记数据”后，程序会提示当前编辑的随记有多少字，占了多少行，我以后也会做一些更详细的统计信息在里面。</p><p style=\"text-indent: 2em;\">好，我现在想写一条随记，我在文本框内打入文字的时候，界面再次发生了变化：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482592789_6698.png\" title=\"1482592789_6698.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">之前那个天骁随记的标题不见了，取而代之的是显示在正中央的地点文字。注意这个过程不是突兀的，它会有一段过渡动画。那个纸飞机飞来飞去的效果我真心喜欢。</p><p style=\"text-indent: 2em;\">在新版的快速输入列表中，我将每个选项想象成了一张小纸片，使用了谁的名字，就好像是揭下了谁的名字一样。</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482593542_5446.png\" title=\"1482593542_5446.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">在手指接触它的一瞬间，你就能感觉出它的颜色和阴影的变化。简直是质感满满。如果在快速输入列表中的某项为空，那么这项的纸片就会像本来就不存在一样。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">谈完了设计方面，我再来谈谈它功能的变化吧。</p><p style=\"white-space: normal; text-indent: 2em;\">当我想选择地点的时候，轻触工具栏上的地点，应用将显示一个集成了地点选择和手动输入的悬浮窗。使用过的地点会被存入数据库内，在输入地点的过程中会根据数据库的查询结果给出地点推荐。</p><p style=\"white-space: normal; text-indent: 2em;\"><img src=\"/article/1482593084_8439.png\" title=\"1482593084_8439.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"white-space: normal; text-indent: 2em;\"><img src=\"/article/1482593137_5286.png\" title=\"1482593137_5286.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"white-space: normal; text-indent: 2em;\">如果想直接使用输入的地点名称，按下悬浮窗的确定按钮即可。另外，当数据库中不存在相关地点的情况下，地点选择列表也会自动显示出正在输入的这个地点。这套逻辑比之前客户端的短按输入，长按选择的逻辑要成熟不少，也智能不少。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">以上介绍的，就是天骁随记客户端v6作为一个发随记的工具的基本素养。可是这个客户端真正强大的地方，远远不只如此。别忘了，它是有史以来最大的一次更新。</p><p style=\"text-indent: 2em;\">当我从主界面左边缘往右滑动的时候，奇迹发生：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482594290_8625.png\" title=\"1482594290_8625.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">原来它还有一个侧边栏。可以清楚地看到整个客户端被分成了五大板块，和额外的设置页和关于页。我们先来看看设置页吧：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482594418_3086.png\" title=\"1482594418_3086.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">从设置页就可以看出在随记的记录和发送方面，新版随记客户端所作出的改变：</p><p style=\"text-indent: 2em;\">1.锁定随记撰写的时间和位置：以前我发随记时，经常有一个痛点存在，在某个地点发生的突发事件，我想记录下这个事件详细的时间和位置的时候，我就必须在原地不动，并以最快的速度发完随记。这样很累。所以，我做了一个改进，在我开始敲下随记第一个字的时候，这个时候的时间便成为了这条随记显示的时间，这个时候获取到的经纬度坐标就是这条随记携带的经纬度坐标。这样子，就算我一边跑步一边发随记，也可以更为准确地记下我想记录的事件的时间和地点。2.</p><p style=\"text-indent: 2em;\">2.允许通过基站和网络记录位置：在新版随记客户端中，我对定位模块也做了极大的改进。原来它只支持GPS获取到的经纬度，现在我令它可以使用网络获取的位置。待我把网站上的对应程序安排好，想必，我以后发表的带有经纬度坐标的随记将会越来越多。而且，现在的定位模块通过监听系统在用户打开/关闭GPS开关时发送的广播来切换工作状态，也算是节约了电量。</p><p style=\"text-indent: 2em;\">3.管理词语映射关系。有时我想在随记中提及一个人，但我不想直接写出他的名字或者全名（有可能上下文已经说了）。这个时候我就要用到随记的隐藏域功能，即两个#号之间的内容是不被直接显示在随记内容里的。网站的百科系统还不能识别出这样的只写名不写姓的情况。所以我发表带有这样内容的随记的时候，为了方便百科系统识别，便会手动在随记内容后面加两个#中间写上他的全名。而现在，这一个过程可以变为自动完成。即维护一个对应列表“A对应B，若随记内容含有A但不含有B，则在发送随记的时候自动在后面补充含有B的隐藏域”。这个界面做的浅显易懂：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482595475_2048.png\" title=\"1482595475_2048.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">按右下角的+号时，会出现一个添加新对应项的弹窗，长按已有的对应项，可以弹出一个含有删除选项的菜单。</p><p style=\"text-indent: 2em;\">这样的话，假如我发送一条随记“云云和晓玲一起出去玩”，那么实际上随记客户端提交的是：</p><p style=\"text-indent: 2em;\">“云云和晓玲一起出去玩#胡云云 赵晓玲#”</p><p style=\"text-indent: 2em;\">网站的百科系统就可以正常识别到这条随记中提到了胡云云和赵晓玲。</p><p style=\"text-indent: 2em;\">4.安全模式：在安全模式下，随记历史将不能查看发送的私有随记，网站管理那里也会存在限制。至于我是怎么限制的呢，待会说哈。</p><p style=\"text-indent: 2em;\">5.测试模式：在测试模式下，发布的随记不会被录入正常的网站随记数据库，这个是我在测试的时候用到的模式。</p><p style=\"text-indent: 2em;\">毕竟，随记发送流程也发生了很大变化。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">历史随记列表是这样的，它会以卡片的形式展示发送在网站上的随记。并且支持了下拉刷新和滑动到底自动继续加载，这也是一大突破。</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482595951_3639.png\" title=\"1482595951_3639.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">长按随记项，会出现一个列表：<br/></p><p style=\"text-indent: 2em;\"><img src=\"/article/1482596116_1834.png\" title=\"1482596116_1834.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">随记客户端上，提供了直接的修改/删除随记的选项！</p><p style=\"text-indent: 2em;\">这个也是解决了我一大痛点。有时发现地点写错了想改地点可是已经按下去了提交按钮，有时不小心把测试的内容或一些胡言乱语发出去了需要删除，觉得前条随记没表达全需要补充……</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482596315_1582.png\" title=\"1482596315_1582.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">可以编辑随记内容、地点、是否公开。按下确定按钮之后，还会显示一个提交中的对话框呢！再根据网站的返回结果给出提示，并实时更新卡片上的随记内容。</p><p style=\"text-indent: 2em;\">好吧，那历史随记界面右上角的按钮是什么，按下去之后，出现了这样的一个界面：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482596470_1397.png\" title=\"1482596470_1397.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">这就是反应出我接下来要介绍的一个重磅功能，也是我有底气取消备用随记服务器的所在：随记发送队列！</p><p style=\"text-indent: 2em;\">之前的随记客户端，一旦我出去旅游什么的，在车上山里信号不好的地方，发送随记的时候就卡壳，甚至发送不出去。每当这个时候，我都要骂它一万次。而现在，我解决了这个问题。</p><p style=\"text-indent: 2em;\">新版随记客户端的发送随记逻辑和之前完全不同。我建立了一个队列发送随记的服务，在点击提交按钮后，随记首将会被写入象征队列的数据库中，然后立刻还原界面使我能迅速开始下一条随记的撰写。我们的随记发送服务会在后台自动发送随记。提交不成功？30s后后台自动重试。我可以从系统通知栏看到随记发送状态，也可以来这个界面看到随记当前的发送状态。</p><p style=\"text-indent: 2em;\">这便意味着我在没有网络/我网站崩溃的时候也可以照常发我的随记，如果网络连通，那么随记客户端就会依次把这些随记提交到网站服务器。每条随记都携带了自己的时间信息，是和具体的提交时间没有关系的。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">接下来我们看排行榜界面，在新版客户端中，可以随时看到当天的百科随记提交排行榜。</p><p style=\"text-indent: 2em;\">网站的百科系统在每天0点的时候，都会把过去七天我发表的随记中提到的人物做一个统计。</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482597240_5956.png\" title=\"1482597240_5956.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">排行榜会被自动加载出来。这张排行榜就是今年圣诞节的排行榜。同时这张排行榜也会被同步到首页的快速输入列表上。</p><p style=\"text-indent: 2em;\">（其实在大一的时候，排名前几的都有几十次的提及数量，现在还真是老了……大家也没有啥交流了）</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">常去地点管理，就是我随记用到的那些地点：</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482597456_4579.png\" title=\"1482597456_4579.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">在管理菜单上，我提供了“提前”和“删除”两个选项。平时这个顺序会受到我最近发表的随记携带的地点而定。</p><p style=\"text-indent: 2em;\">实际上，地点管理这一块未来还可以有很多文章可以做……</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">而网站管理板块，便提供了我控制网站的一些途径。包括首页显示的那个签名还有一些功能限制之类的。实际上这些设置在之前的随记客户端版本曾经有过异形的支持（比如发送含有命令语句的随记），而现在终于规范化了。</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482597753_2060.png\" title=\"1482597753_2060.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">如果我在安全模式下，修改了这上面的内容，按了右上角的保存按钮时，会发生什么？</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482598035_1693.png\" title=\"1482598035_1693.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">没错，校验指纹<img src=\"https://img.baidu.com/hi/jx2/j_0007.gif\"/><img src=\"https://img.baidu.com/hi/jx2/j_0007.gif\"/><img src=\"https://img.baidu.com/hi/jx2/j_0007.gif\"/></p><p style=\"text-indent: 2em;\">实际上，在设置页关闭安全模式开关的时候，也是需要校验指纹的<img src=\"https://img.baidu.com/hi/jx2/j_0007.gif\"/><img src=\"https://img.baidu.com/hi/jx2/j_0007.gif\"/></p><p style=\"text-indent: 2em;\">我没有说这种方法绝对安全，但至少别人没有我的安装包，就动不了我的东西~~</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">好，最后我们回顾一下这次天骁随记安卓客户端的伟大更新：</p><p style=\"text-indent: 2em;\">1.全新的界面，崭新的UI设计。</p><p style=\"text-indent: 2em;\">2.队列提交随记，再也不用担心发送失败。</p><p style=\"text-indent: 2em;\">3.增强的地点选择列表，拥有地点推荐功能。</p><p style=\"text-indent: 2em;\">4.查看历史随记，编辑/删除之前的随记。</p><p style=\"text-indent: 2em;\">5.直观地查看当日随记排行榜。</p><p style=\"text-indent: 2em;\">6.增强且独立的网站管理模块。</p><p style=\"text-indent: 2em;\">7.支持自动处理关键词映射。</p><p style=\"text-indent: 2em;\">8.优化定位性能，支持通过网络获取位置信息。</p><p style=\"text-indent: 2em;\">9.支持调用Android6.0指纹识别API，增强安全性防护。</p><p style=\"text-indent: 2em;\">……</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">这次的开发过程是我一次追求和主流应用层次对接的实践过程，在开发过程中，新学会了不少关于Android开发的知识。边学变做。需要把这些功能完美地集合在一个APP上，我也是做了大量的测试和调整工作才得以完成。这一个月里我的空闲时间基本都贡献给这个了。</p><p style=\"text-indent: 2em;\">所以此时此刻我很开心、快乐。</p><p style=\"text-indent: 2em;\">如果有时间的话，我会在QQ空间和知乎上也谈一谈这个应用。</p><p style=\"text-indent: 2em;\"><br/></p><p style=\"text-indent: 2em;\">最后我发一张关于的截图吧。</p><p style=\"text-indent: 2em;\"><img src=\"/article/1482598788_5564.png\" title=\"1482598788_5564.png\" alt=\"blob.png\" width=\"470\" style=\"width: 470px;\"/></p><p style=\"text-indent: 2em;\">（图标好丑~~~谁能帮我重新设计一个啊~~~~）</p>","createTime":"2016-12-25 01:01:19","customCoverKey":"","id":171,"isGood":true,"isTop":false,"publicState":0,"replyCount":0,"state":0,"tags":["编程","安卓","随记"],"title":"天骁随记Android客户端v6一览。","urlCode":"L03WE3X8RQ","viewCount":857,"viewGroup":-1,"authPassed":true},"author":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}}}