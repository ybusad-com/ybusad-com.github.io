{"code":0,"msg":"ok","data":{"article":{"authorCode":"admin","authorName":"孙天骁","classify":"技术类","content":"<p>在“光辉号”骁之屋的概念提出一年多之后，我已经充分验证了网站新架构的实施可行性，并也于2020年完成了一部分网站功能向新技术栈的迁移。在2021年，我会继续加快迁移的进程。但在此之前，我不禁思考一个问题：在网站设计目标越来越复杂的情况下，能不能沉淀出一些通用能力，用于支撑新功能的快速开发？</p><p><br></p><p>Spollo 光辉号骁之屋配置中心就是我于 2021 年初的一个小小尝试。它是一个集中式的配置中心。我们配置中心的用途主要有两种：1是快速配置网站上显示的文案和一些行为，2是能够为后续的功能开发提供一个储存/读取数据、管理版本的通用能力。那么为了实现这两个目标，我需要设计一些接口供管理中心调用，以及一些接口供后续的程序开发调用。Spollo 会提供命名空间、配置发布、配置回滚、比较版本等等功能。</p><p><br></p><p><img src=\"/article/43f0278b0371869312.jpg\"></p><p><br></p><p>从 Spollo 的管理界面看到，所有配置项被命名空间（namespace）分组；配置本身是类似 Key-Value 的格式，同时也存储了备注、修改人、修改时间等等信息。一个命名空间内不能有相同名称的&nbsp;Key。在前台应用查询时，会根据命名空间及命名空间中的 Key 查询最新配置。</p><p><br></p><p><img src=\"/article/58c7fae1516993418c.jpg\"></p><p><img src=\"/article/e732887eb8abf60cdb.jpg\"></p><p><br></p><p>点击添加命名空间，会打开添加命名空间弹窗。一般一个业务会使用一个命名空间。新建的命名空间处于未发布状态。需要添加配置之后操作发布。</p><p><br></p><p>对添加好的配置，我们可以继续修改，修改之后的配置，点击“比较 &amp; 发布配置” 按钮，会有弹窗供比较这次修改了什么配置，点击发布按钮，就会应用这个配置。</p><p><br></p><p><img src=\"/article/91dd8892f1c3e10e2c.jpg\"></p><p><img src=\"/article/9c4e78e1fe8247e209.jpg\"></p><p><br></p><p>发布之后，可以点击发布历史按钮，查看发布历史。会出现一个侧边浮窗，供比较任意两次发布的配置，或者操作回滚到以前的配置。</p><p><br></p><p><img src=\"/article/3ea0a0e14cde3e9680.jpg\"></p><p><img src=\"/article/455b7e98680fd49704.jpg\"></p><p><img src=\"/article/5c488abcf0ec08b506.jpg\"></p><p>回滚配置，实际上是产生一条和之前某条配置一样的配置并且自动发布。</p><p><br></p><p>在数据库设计上，实际数据库设计比较简单。分成两张表，一张表存储命名空间信息，一张表存储具体的配置信息。每个命名空间的每个配置版本都对应表中的一条记录，再通过 JSON 来存储具体每个配置的 Key-Value。</p><p><br></p><p>一共为配置后台设计了12个接口：</p><p><br></p><p>postAddNamespace（添加命名空间）</p><p>postEditNamespace（修改命名空间信息）</p><p>postDeleteNamespace（删除命名空间）</p><p>getConfigChange（获取某命名空间的未发布改动）</p><p>postPublishChange（发布某个命名空间的配置）</p><p>postGiveUpChange（放弃对某个命名空间的未发布修改）</p><p>getListAllConfig（列出界面上展示的所有命名空间的所有配置）</p><p>postEditConfig（添加或编辑某条配置）</p><p>postDeleteConfig（删除某条配置）</p><p>getListPublish（根据命名空间查询发布记录）</p><p>postReusePublish（回滚到某个配置）</p><p><br></p><p>也为前台应用调用设计了6个接口：</p><p>getSingleConfig（获取单条配置）</p><p>getAllConfigInNamespace（根据命名空间获取所有配置）</p><p>postCreateConfigChange（开启一个新的配置变更）</p><p>postEditConfigInChange（添加/编辑某个配置）</p><p>postPublishChange（发布配置变更）</p><p>postCancelChange（取消配置变更）</p><p><br></p><p>接口的设计都是很浅显易懂的，这里不做赘述，感兴趣的话可以联系我，我会视情况给你开通管理员权限让你真实体验。</p><p><br></p><p>网站的第一个接入 Spollo 的功能已经上线了。就是光辉号架构下的新版“关于”页面。把其中需要频繁变动的文案内容接入 Spollo，这样每次修改只需要在配置中心修改配置，而无需走 修改代码 - 自测 -&nbsp;打包 - 发布 整个流程。</p><p><br></p><p><img src=\"/article/3a3e9c3d1fb1c5cf65.jpg\"></p><p><br></p><p>在整个 2021 年，光辉号骁之屋的继续开发还有大量的工作要做。包括文章系统的继续完善（文章评论接入提及功能等，光辉号骁之屋前端 UI 组件库 splendor-ui 已经支持处理提及的前端组件），再到重构网站的消息系统和随记系统，再到重新设计网站首页。我会努力让你们在年底时分看到一个界面更美观、内容更丰富、功能更强大的个人网站。届时，我将可以更好地通过网站管理我的生活，你们也更加能够通过网站去了解真实精彩的我。</p>","createTime":"2021-01-31 13:49:10","customCoverKey":"","id":280,"isGood":true,"isTop":false,"publicState":0,"replyCount":4,"state":0,"tags":["骁之屋","光辉号","网站开发","网站建设"],"title":"光辉号骁之屋配置中心 Spollo 介绍","urlCode":"spollo","viewCount":205,"viewGroup":-1,"authPassed":true},"author":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}}}