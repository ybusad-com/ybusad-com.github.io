{"code":0,"msg":"ok","data":{"barInfo":{"barName":"骁","description":"开放自由的类贴吧式留言板","isMainBar":true,"isPublic":true},"list":[{"author":"孙天骁","authorCode":"admin","content":"<p>主要是修正Orientation为6或8的情况：</p><pre spellcheck=\"false\">/* \n  根据照片EXIF信息修正照片旋转\n  孙天骁于2019-6-16\n*/\n\nconst NEED_CLOCKWISE = 6;\nconst NEED_ANTICLOCKWISE = 8;\n\nconst NEED_ROTATE_ENUM = [NEED_CLOCKWISE, NEED_ANTICLOCKWISE];\n\nimport EXIF from 'exif-js';\n\nexport default function fixOrientation (oFile) {\n  return new Promise((resolve, reject) =&gt; {\n    EXIF.getData(oFile, function () {\n      const orientation = EXIF.getTag(this, 'Orientation');\n      const oReader = new FileReader();\n      oReader.onerror = reject;\n      oReader.onload = () =&gt; {\n        const result = oReader.result;\n\n        // 如果图片不需要旋转，直接返回base64\n        if (NEED_ROTATE_ENUM.includes(orientation)) {\n          \n          const oImage = new Image();\n          oImage.onerror = reject;\n          oImage.onload = () =&gt; {\n            const canvas = document.createElement('canvas');\n            canvas.width = oImage.naturalHeight;\n            canvas.height = oImage.naturalWidth;\n\n            const ctx = canvas.getContext('2d');\n\n            if (NEED_CLOCKWISE === orientation) {\n\n              // 顺时针旋转图片\n              ctx.translate(canvas.width, 0);\n              ctx.rotate(Math.PI / 2);\n              ctx.drawImage(oImage, 0, 0);\n\n            } else {\n\n              // 逆时针旋转图片\n              ctx.translate(0, canvas.height);\n              ctx.rotate(-Math.PI / 2);\n              ctx.drawImage(oImage, 0, 0);\n\n            }\n\n            resolve(canvas.toDataURL('image/jpeg'), oReader);\n\n          };\n          oImage.src = result;\n\n        } else {\n          resolve(result, oReader);\n        }\n      };\n\n      oReader.readAsDataURL(oFile);\n    });\n  });\n};\n</pre> ","floor":1,"pid":0,"postTime":"2019-06-16 20:21:46","replyCount":0,"signKey":"","source":"","sourceUrl":"","tid":2972},{"author":"孙天骁","authorCode":"admin","content":"<p>以及Java代码，Java代码很简单，也不需要额外的库。</p><pre spellcheck=\"false\">// 旋转图像。有90度、270度两个选项\npublic static Bitmap rotate(Bitmap bmp, int type) {\n    Matrix matrix = new Matrix();\n\n    if (type == ExifInterface.ORIENTATION_ROTATE_90) {\n        matrix.postRotate(90);\n    } else if (type == ExifInterface.ORIENTATION_ROTATE_270) {\n        matrix.postRotate(270);\n    } else {\n        return bmp;\n    }\n\n    Bitmap dstMap = Bitmap.createBitmap(bmp, 0, 0, bmp.getWidth(), bmp.getHeight(), matrix, true);\n    return dstMap;\n}\n</pre> ","floor":2,"pid":8675,"postTime":"2019-06-16 20:25:44","replyCount":0,"signKey":"","source":"","tid":2972},{"author":"孙天骁","authorCode":"admin","content":"<pre spellcheck=\"false\">ExifInterface exifInterface = new ExifInterface(photoPath);\nint Orientation = Integer.valueOf(exifInterface.getAttribute(ExifInterface.TAG_ORIENTATION));\nsmallBitmap = BitmapUtil.rotate(smallBitmap, Orientation);\n</pre> ","floor":3,"pid":8676,"postTime":"2019-06-16 20:26:43","replyCount":0,"signKey":"","source":"","tid":2972}],"pageInfo":{"total":3,"pageSize":30,"current":1},"threadInfo":{"author":"孙天骁","authorCode":"admin","classifyName":"技术","goodClassifyName":"","id":2972,"isGood":false,"isPicture":false,"isRepost":false,"postTime":"2019-06-16 20:21:46","replyCount":2,"title":"分享一下我刚才写的修正照片方向的代码","topState":0},"tid":2972,"total":3,"totalPages":1,"viewHost":false,"users":{"admin":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}},"needVerify":true}}