{"barInfo":{"barName":"骁","description":"开放自由的类贴吧式留言板","isMainBar":true,"isPublic":true},"list":[{"author":"孙天骁","authorCode":"admin","content":"<p>docker发展历史</p><p>1979年 第一次出现虚拟化思想 管理task 避免崩溃时影响其他task</p><p>2000年 openVZ cvm 虚拟机，有多个操作系统在内核上</p><p>linux container 虚拟机应用同一个内核 速度快很多</p><p>docker起源于linux container</p><p>process container 又叫cgroups 可以限制应用资源使用，是docker的一个基本能力之一</p><br><p>怎样做一个更轻的虚拟机</p><p>docker libcontainer 将lsc的概念拓展到全平台，不止于linux</p><p>docker工作流 我们呈现给你的产品是打包的 就是moby 对物理资源有个抽象，可以应用到操作系统层面</p><p>docker ee是在docker ce上的功能增强</p><br><p>比对一下os和kernel，kernel和os是什么关系？</p><p>linux内核具有的功能：多用户、多任务、可移植性、文件系统</p><p>操作系统关注的事情：selinux（做安全的）systemd（防止你的进程挂掉）yum包管理 gcc gui</p><p>docker镜像会打包这些东西，不会打包kernel</p><br><p>docker是怎么跑起来的？</p><p>docker就是利用Linux现有的功能对你的应用进行隔离和编排</p><p>1. namespace 将两个应用放在不同的namespace上那就感知不到对方</p><p>2. 网络隔离</p><p>3. pid隔离</p><p>4. ns隔离 ups、ips……</p><p>要做安全性的隔离，还有资源上的隔离</p><p>资源隔离不能用namespace，就是用cgroup</p><p>cgroup：devices memory cpu时间片 pid进程id</p><br><p>docker又利用了Linux的一个功能叫做hyperroot 虚拟的文件资源 Linux通过文件管理各种设备</p><p>docker的一个非常重要的思想：layer</p><p>通过一层一层组装起来的</p><p>unionfs 可以让你的多个文件夹下的文件进行合并</p><br><p>下面k8s</p><p>google搞出来很多东西</p><p>google各种开源的东西都很牛逼</p><p>ETCD node工作节点 master调度节点 通过etcd分布式数据库存储</p><p>底层是用的一个叫做raft</p><p>etcd能做的事情 Put get 事务 批量 watch 高可用</p><p>状态机 etcd有一个leader，数据往leader发 leader往follower发 如果leader挂了 那follower内部选出一个leader</p><p>接收数据的过程 client发给leader 接收数据的工作流 leader发给follower f确认接收 中间还有很多细节</p><p>kubectl 创建容器 3份负载均衡 更新1个docker这个docker有三个镜像 首先停掉一个docker镜像 创建一个新的 一步一步来 通过controller manager管理，scheduler可以去检测哪台机器的负债比较小 metrics-server fluentd做日志收集 clusterdns kube-proxy 这个东西层层抽象 非常复杂</p><p>dns是一种协议 k8s维护了很多虚拟ip 也可以用dns管理</p><br><p>下一页是configure配置</p><p>第一种抽象是对无状态请求的抽象 一个http请求是一个无状态 有些container优先于其他container 服务间通信 initContainer 每一个Pod里面有一个Initcontainer 还可能有n个container 这样基础通信服务就先起了</p><p>pod：永远不要自定义一个Pod的声明 要一个deployment的声明，对你整个部署状态的一个抽象</p><p>第二种抽象就是 StatefulSet 有状态应用的抽象 比如mysql</p><p>始终会有一个队列 对应Pod的各种启动关系 对这种队列的一个xx 一个statefulSet</p><p>job定时任务 job底层也是pod，job controller cronJob</p><br><p>controller会决定要创建多少个pod</p><p>这个api service会决定你要创建多少个pod</p><p>etcd就是大脑</p><br><p>service mesh 服务网格</p><p>服务网格的核心概念就是让服务通信进行下沉</p><p>服务的配置 服务的配置 服务的配置 这个我看看 运维和开发的职责是 跨语言业务通信 node应用和Java应用 我的Node端和Java端要商量一个序列化和反序列化的格式 如果我把这些通信进行下沉 不考虑Ip之类的事情。</p><br><p>下面一个compatation</p><p>比较consul istio linkerd</p><p>data panel / control panel</p><p>从a应用发到b应用 请求权限的话 check就会失败</p><p>sdn</p><br><p>consul</p><p>Config SDS</p> ","floor":1,"pid":0,"postTime":"2019-12-20 18:41:52","replyCount":0,"signKey":"","source":"","sourceUrl":"","tid":3004}],"pageInfo":{"total":1,"pageSize":30,"current":1},"threadInfo":{"author":"孙天骁","authorCode":"admin","classifyName":"闲谈","goodClassifyName":"","id":3004,"isGood":false,"isPicture":false,"isRepost":false,"postTime":"2019-12-20 18:41:52","replyCount":0,"title":"刚才听新尧分享记了一堆混乱的东西。。","topState":0},"tid":3004,"total":1,"totalPages":1,"viewHost":false,"users":{"admin":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}},"needVerify":true}