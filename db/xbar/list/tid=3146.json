{"code":0,"msg":"ok","data":{"barInfo":{"barName":"骁","description":"开放自由的类贴吧式留言板","isMainBar":true,"isPublic":true},"list":[{"author":"孙天骁","authorCode":"admin","content":"<p>（一）JSONP 跨域</p><p>\t\t对方用 callback 回调的方式调用一个这边注册的全局函数，传递数据</p><p>（二）document.domain + iframe：</p><p>\t\t只限主域相同子域名不同的场景。通过设置 document.domain 为主域名，iframe 内就可以 window.parent 访问另外一个页面的数据。</p><p>（三）location.hash + iframe：</p><p>\t\ta 和 b 通信，使用中间页 c 实现跨域。 原理是 a -&gt; b -&gt; c 通过 iframe 的 hash 传递数据，如果 c 和 a 同源，c就可以使用 window.parent.parent 访问 a 的数据。</p><p>（四）window.name + iframe</p><p>\t\twindow.name 的特性：name可以在不同的页面（甚至不同域名加载后依然存在，而且name最长可以存2MB的数据）</p><p>\t\ta 和 b 通信，让 b 在 window.name 中写数据再跳转到和a同源的页面c，然后a就可以去访问iframe内的window.name了。</p><p>（五）postMessage 跨域</p><p>\t\tpostMessage 可以解决：（1）页面和其打开的新窗口的数据传递 （2）多窗口之间的消息传递 （3）页面与嵌套的 iframe 消息传递 （4）上面三个场景的跨域数据传递</p><p>\t\t使用时也可以借助 iframe，postMessage允许跨域调用，因此可以直接调对方的 postMessage完成数据通信。例如：iframe.contentWindow.postMessage(JSON.stringify(data), '<a href=\"http://s2.ybusad.com\" target=\"_blank\">http://s2.ybusad.com</a>')</p><p>（六）跨域资源共享，CORS</p><p>\t\t主要服务端需要设置：Access-Control-Allow-Origin，如果需要携带 cookies，还需要设置 Access-Control-Allow-Credentials。</p><p>\t\tCORS 会区分简单请求和复杂请求。复杂请求会发起预检。</p><p>\t\t复杂请求（非简单请求）：请求方法不是 HEAD、GET、POST，同时请求头不能含有自定义头，且不能使用 Content-type: Application/json </p><p>\t\t预检请求使用 OPTIONS 请求，会携带 Access-Control-Request-Method 和 Access-Control-Request-Headers，以及 Origin。</p><p>\t\t回复预检请求，需要返回 Access-Control-Allow-Origin，还可以返回 Access-Control-Allow-Headers、Access-Control-Allow-Credentials、Access-Control-Max-Age、Access-Control-Allow-Methods</p><p>（七）Nginx 代理</p><p>\t\t主要是可以将不同的子域名直接代理另外一个完全不同的域名（中转一下），然后再靠 CORS 等方式和子域名跨域请求资源。</p><p>\t\t主要配置项：proxy_pass、proxy_cookie_domain、add_header Access-Control-Allow-Origin **</p><p>Node.js 代理</p><p>（八）Node 代理</p><p>\t\t把 Nginx 的工作换成用 Node 实现，例如使用 express + http-proxy-middleware</p><p>（九）WebSocket 跨域</p><p>\t\t利用 WebSocket 可以跨域通信的特征，浏览器和跨域的服务器建立 WebSocket 连接，可以双向传递数据。</p> ","floor":1,"pid":0,"postTime":"2021-06-22 14:17:19","replyCount":0,"signKey":"","source":"","sourceUrl":"","tid":3146}],"pageInfo":{"total":1,"pageSize":30,"current":1},"threadInfo":{"author":"孙天骁","authorCode":"admin","classifyName":"技术","goodClassifyName":"","id":3146,"isGood":false,"isPicture":false,"isRepost":false,"postTime":"2021-06-22 14:17:19","replyCount":0,"title":"前端跨域方法大全","topState":0},"tid":3146,"total":1,"totalPages":1,"viewHost":false,"users":{"admin":{"exists":true,"name":"孙天骁","code":"admin","alias":"stx","description":"一个内心丰富的人","homepageUrl":"/u/stx","group":5,"groupName":"站长","isLocked":false,"gender":1,"avatarUrl":"/s/user/FufL-vSFO5eM1we1mxdfYHKH9tfK.jpg","realName":"孙天骁","refBaike":"","isManager":true,"isMe":true,"isLover":false,"introduction":"","joinTime":"2015-02-11 21:45:00"}},"needVerify":true}}