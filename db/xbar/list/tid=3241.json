{"code":0,"msg":"ok","data":{"barInfo":{"barName":"骁","description":"开放自由的类贴吧式留言板","isMainBar":true,"isPublic":true},"list":[{"author":"l4m2","authorCode":"5E1FB018E3","content":"<pre>$ curl '<a href=\"https://chatgpt.ctfcode.com/api2/chat\" target=\"_blank\">https://chatgpt.ctfcode.com/api2/chat</a>' \\\n&nbsp; -H 'Accept-Language: zh-CN,zh;q=0.9' \\\n&nbsp; -H 'Connection: keep-alive' \\\n&nbsp; -H 'Content-Type: application/json' \\\n&nbsp; -H 'Origin: <a href=\"https://chatgpt.ctfcode.com\" target=\"_blank\">https://chatgpt.ctfcode.com</a>' \\\n&nbsp; -H 'Referer: <a href=\"https://chatgpt.ctfcode.com/\" target=\"_blank\">https://chatgpt.ctfcode.com/</a>' \\\n&nbsp; -H 'Sec-Fetch-Dest: empty' \\\n&nbsp; -H 'Sec-Fetch-Mode: cors' \\\n&nbsp; -H 'Sec-Fetch-Site: same-origin' \\\n&nbsp; -H 'accept: text/event-stream' \\\n&nbsp; -H 'token: aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' \\\n&nbsp; --data-raw '{\"content\":\"KKPP\",\"user_id\":10001,\"chat_history\":[{\"type\":\"chatgpt\",\"text\":\"What is 1 plus 1?\"}]}' \\\n&nbsp; --compressed\nTraceback (most recent call last):\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/errors.py\", line 162, in __call__\n&nbsp; &nbsp; await self.app(scope, receive, _send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/cors.py\", line 92, in __call__\n&nbsp; &nbsp; await self.simple_response(scope, receive, send, request_headers=headers)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/cors.py\", line 147, in simple_response\n&nbsp; &nbsp; await self.app(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n&nbsp; &nbsp; raise exc\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n&nbsp; &nbsp; await self.app(scope, receive, sender)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/middleware/asyncexitstack.py\", line 21, in __call__\n&nbsp; &nbsp; raise e\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n&nbsp; &nbsp; await self.app(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/routing.py\", line 718, in __call__\n&nbsp; &nbsp; await route.handle(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/routing.py\", line 276, in handle\n&nbsp; &nbsp; await self.app(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/routing.py\", line 66, in app\n&nbsp; &nbsp; response = await func(request)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/routing.py\", line 237, in app\n&nbsp; &nbsp; raw_response = await run_endpoint_function(\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/routing.py\", line 163, in run_endpoint_function\n&nbsp; &nbsp; return await dependant.call(**values)\n&nbsp; File \"main3.py\", line 220, in chat\n&nbsp; &nbsp; logger.info(\"user: %s, chat: %s\", user_info['name'], chat_content)\nTypeError: 'NoneType' object is not subscriptable\n$ curl '<a href=\"https://chatgpt.ctfcode.com/api2/chat\" target=\"_blank\">https://chatgpt.ctfcode.com/api2/chat</a>' \\\n&nbsp; -H 'Accept-Language: zh-CN,zh;q=0.9' \\\n&nbsp; -H 'Connection: keep-alive' \\\n&nbsp; -H 'Content-Type: application/json' \\\n&nbsp; -H 'Origin: <a href=\"https://chatgpt.ctfcode.com\" target=\"_blank\">https://chatgpt.ctfcode.com</a>' \\\n&nbsp; -H 'Referer: <a href=\"https://chatgpt.ctfcode.com/\" target=\"_blank\">https://chatgpt.ctfcode.com/</a>' \\\n&nbsp; -H 'Sec-Fetch-Dest: empty' \\\n&nbsp; -H 'Sec-Fetch-Mode: cors' \\\n&nbsp; -H 'Sec-Fetch-Site: same-origin' \\\n&nbsp; -H 'accept: text/event-stream' \\\n&nbsp; --data-raw '{\"content\":\"KKPP\",\"user_id\":10001,\"chat_history\":[{\"type\":\"chatgpt\",\"text\":\"What is 1 plus 1?\"}]}' \\\n&nbsp; --compressed\nTraceback (most recent call last):\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/errors.py\", line 162, in __call__\n&nbsp; &nbsp; await self.app(scope, receive, _send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/cors.py\", line 92, in __call__\n&nbsp; &nbsp; await self.simple_response(scope, receive, send, request_headers=headers)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/cors.py\", line 147, in simple_response\n&nbsp; &nbsp; await self.app(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/exceptions.py\", line 79, in __call__\n&nbsp; &nbsp; raise exc\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/middleware/exceptions.py\", line 68, in __call__\n&nbsp; &nbsp; await self.app(scope, receive, sender)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/middleware/asyncexitstack.py\", line 21, in __call__\n&nbsp; &nbsp; raise e\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n&nbsp; &nbsp; await self.app(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/routing.py\", line 718, in __call__\n&nbsp; &nbsp; await route.handle(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/routing.py\", line 276, in handle\n&nbsp; &nbsp; await self.app(scope, receive, send)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/starlette/routing.py\", line 66, in app\n&nbsp; &nbsp; response = await func(request)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/routing.py\", line 237, in app\n&nbsp; &nbsp; raw_response = await run_endpoint_function(\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/fastapi/routing.py\", line 163, in run_endpoint_function\n&nbsp; &nbsp; return await dependant.call(**values)\n&nbsp; File \"main3.py\", line 219, in chat\n&nbsp; &nbsp; user_info = db.get_user_info(token)\n&nbsp; File \"/root/chatgpt-assist-server/db.py\", line 77, in get_user_info\n&nbsp; &nbsp; user_info = cache.get(token)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/commands/core.py\", line 1790, in get\n&nbsp; &nbsp; return self.execute_command(\"GET\", name)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/client.py\", line 1258, in execute_command\n&nbsp; &nbsp; return conn.retry.call_with_retry(\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/retry.py\", line 46, in call_with_retry\n&nbsp; &nbsp; return do()\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/client.py\", line 1259, in &lt;lambda&gt;\n&nbsp; &nbsp; lambda: self._send_command_parse_response(\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/client.py\", line 1234, in _send_command_parse_response\n&nbsp; &nbsp; conn.send_command(*args)\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/connection.py\", line 841, in send_command\n&nbsp; &nbsp; self._command_packer.pack(*args),\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/connection.py\", line 557, in pack\n&nbsp; &nbsp; for arg in map(self.encode, args):\n&nbsp; File \"/usr/local/lib/python3.8/site-packages/redis/connection.py\", line 115, in encode\n&nbsp; &nbsp; raise DataError(\nredis.exceptions.DataError: Invalid input of type: 'NoneType'. Convert to a bytes, string, int or float first.\n\n\n</pre>","floor":1,"pid":0,"postTime":"2023-07-28 15:08:23","replyCount":0,"signKey":"","source":"","sourceUrl":"","tid":3241}],"pageInfo":{"total":1,"pageSize":30,"current":1},"threadInfo":{"author":"l4m2","authorCode":"5E1FB018E3","classifyName":"技术","goodClassifyName":"","id":3241,"isGood":false,"isPicture":false,"isRepost":false,"postTime":"2023-07-28 15:08:23","replyCount":0,"title":"https://chatgpt.ctfcode.com/api2/chat token","topState":0},"tid":3241,"total":1,"totalPages":1,"viewHost":false,"users":{"5E1FB018E3":{"exists":true,"name":"l4m2","code":"5E1FB018E3","alias":"","description":"本网站高危测试解决号","homepageUrl":"/u/5E1FB018E3","group":4,"groupName":"管理员","isLocked":false,"gender":0,"avatarUrl":"/common/person.jpg","realName":"","refBaike":"","isManager":true,"isMe":false,"isLover":false,"introduction":"","joinTime":"2015-05-30 20:11:49"}},"needVerify":true}}