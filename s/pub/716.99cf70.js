"use strict";(self.webpackChunksplendor_pc=self.webpackChunksplendor_pc||[]).push([[716],{63716:(n,e,t)=>{t.r(e),t.d(e,{default:()=>h});var o=t(66252),l=t(2262),i=t(81181),u=t(23691),a=t(93224),c=t(73159),s=t(18037),r=t(2287),d=t(92818),f=t(85191);const m=(0,o.aZ)({name:"ThumbPhoto",props:{onClick:Function,onClose:Function,src:{type:String,required:!0}},setup:function(n){return function(){return(0,o.Wm)("div",{class:"thumb--hu9rE"},[(0,o.Wm)("img",{src:n.src,onClick:n.onClick},null),(0,o.Wm)("span",{class:"close--78f-n",onClick:n.onClose},null)])}}});var p=(0,o.aZ)({name:"EditEssayDialogBody",props:{id:{type:Number,required:!0},onConfirm:Function,onDelete:Function},setup:function(n){if(!(0,s.useIsMe)().value)return i.Notify.error("权限验证失败！"),function(){return"您无权修改该随记"};var e=(0,l.ref)(),t=(0,l.reactive)({content:"",photoKeys:[],eventTags:[],place:"",isPublic:!0,isSaving:!1});(0,o.bv)((function(){(0,f.getEssayDetail)({id:n.id}).then((function(n){var e;t.content=n.detail.content,t.photoKeys=n.detail.photos,t.eventTags=null!==(e=n.detail.eventTagsDetail)&&void 0!==e?e:[],t.isPublic=n.detail.isPublic,t.place=n.detail.place})).catch((function(n){i.Notify.error(n)}))}));var p=function(n){(0,u.Z)(e.value.querySelector("textarea"),n)},h=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i.Preview.images({list:t.photoKeys.map((function(n){return(0,s.fullfillImage)(n)})),index:n})},v=function(){if(!(t.photoKeys.length<2)){var n=[t.photoKeys[1],t.photoKeys[0]];t.photoKeys[0]=n[0],t.photoKeys[1]=n[1]}},y=function(n){t.photoKeys.splice(n,1)},g=function(){if(""!==t.content.trim()){t.isSaving=!0;var e={id:n.id,content:t.content,place:t.place,isPublic:t.isPublic,eventTags:t.eventTags.map((function(n){return n.name}))};t.photoKeys[0]&&(e.photoKey1=t.photoKeys[0]),t.photoKeys[1]&&(e.photoKey1=t.photoKeys[1]),(0,f.postEditEssay)(e).then((function(){var e;i.Notify.success("已编辑"),null===(e=n.onConfirm)||void 0===e||e.call(n)})).catch((function(n){i.Notify.error(n)})).finally((function(){t.isSaving=!1}))}else i.Notify.info("请输入随记内容")},W=function(){i.SweetAlert.confirm({title:"确认删除随记",content:"确认删除这条随记吗？删除后将不可恢复。",maskClosable:!0,closeOnEsc:!1,onConfirm:function(){return(0,f.postDeleteEssay)({id:n.id}).then((function(){var e;i.Notify.success("已删除"),null===(e=n.onDelete)||void 0===e||e.call(n)}))}})};return function(){return(0,o.Wm)("div",{ref:e},[(0,o.Wm)(c.Z,null,{default:function(){return[(0,o.Wm)("div",{class:"input--Zq1A2"},[(0,o.Wm)(i.Textarea,{height:200,placeholder:"随记内容…",modelValue:t.content,"onUpdate:modelValue":function(n){return t.content=n},block:!0},null),(0,o.Wm)("div",{class:"bg--i-m2a"},null),(0,o.Wm)("div",{class:"handles--A+b+u"},[(0,o.Wm)("div",{class:"emoji--0aE4-"},[(0,o.Wm)(a.Z,{onSelect:p},null)]),t.photoKeys.length>0&&(0,o.Wm)("div",{class:"photo--sDXqn"},[(0,o.Wm)(i.Popover,{position:"right-center",mouseLeaveDelay:500},{default:function(){return[(0,o.Wm)(i.Badge,{value:t.photoKeys.length},{default:function(){return[(0,o.Wm)("img",{class:"icon--3KlaB",src:(0,s.fullfillImage)("s/ast/p775zh339tl9dw0slp.png")},null)]}})]},content:function(){return(0,o.Wm)("div",null,[(0,o.Wm)(m,{src:(0,s.fullfillImage)(t.photoKeys[0],"imageView2/2/h/160"),onClick:h.bind(null,0),onClose:y.bind(null,0)},null),t.photoKeys.length>1&&(0,o.Wm)(o.HY,null,[(0,o.Wm)("div",{class:"swap--kdThZ"},[(0,o.Wm)(i.Tooltip,{content:"交换照片"},{default:function(){return[(0,o.Wm)("a",{onClick:v},[(0,o.Wm)(i.Icon,{type:"trip"},null)])]}})]),(0,o.Wm)(m,{src:(0,s.fullfillImage)(t.photoKeys[1],"imageView2/2/h/160"),onClick:h.bind(null,1),onClose:y.bind(null,1)},null)])])}})]),(0,o.Wm)("div",{class:"tags--e7Vo3"},[(0,o.Wm)(d.Z,{modelValue:t.place,"onUpdate:modelValue":function(n){return t.place=n}},null),(0,o.Wm)(r.Z,{modelValue:t.eventTags,"onUpdate:modelValue":function(n){return t.eventTags=n}},null)])])])]}}),(0,o.Wm)(c.Z,null,{default:function(){return[(0,o.Wm)("div",{style:{textAlign:"right"}},[(0,o.Wm)(i.Button,{class:"delete--tX-+1",type:"danger",icon:"delete",onClick:W},{default:function(){return[(0,o.Uk)("删除")]}}),(0,o.Wm)(i.Checkbox,{style:{marginRight:"12px"},modelValue:t.isPublic,"onUpdate:modelValue":function(n){return t.isPublic=n}},{default:function(){return[(0,o.Uk)("公开随记")]}}),(0,o.Wm)(i.Button,{type:"primary",icon:"save",onClick:g,loading:t.isSaving},{default:function(){return[(0,o.Uk)("保存")]}})])]}})])}}});const h=(0,o.aZ)({name:"EditEssayDialog",props:{id:{type:Number,required:!0},onConfirm:Function,onDelete:Function},setup:function(n,e){var t=e.emit,l=function(){t("update:modelValue",!1)},u=function(){var e;l(),null===(e=n.onConfirm)||void 0===e||e.call(n)},a=function(){var e;l(),null===(e=n.onDelete)||void 0===e||e.call(n)};return function(){return(0,o.Wm)(i.Dialog,{title:"编辑随记 #".concat(n.id),maskClosable:!1},{default:function(){return[(0,o.Wm)(p,{id:n.id,onConfirm:u,onDelete:a},null)]}})}}})}}]);
//# sourceMappingURL=716.99cf70.js.map