"use strict";(self.webpackChunksplendor_pc=self.webpackChunksplendor_pc||[]).push([[832],{52596:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.postBindUser=t.getBindUserByIndexID=void 0;var r=i(n(6974));t.getBindUserByIndexID=function(e){return(0,r.default)("GET","/baike/bind/getBindUserByIndexID.json",e)},t.postBindUser=function(e){return(0,r.default)("POST","/baike/bind/postBindUser.json",e)}},6918:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getData=void 0;var r=i(n(6974));t.getData=function(){return(0,r.default)("GET","/user/selector/getData.json")}},41269:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.postEditRelated=t.postEdit=t.getDetail=t.postCreatePersonItem=void 0;var r=i(n(6974));t.postCreatePersonItem=function(e){return(0,r.default)("POST","/baike/person/edit/postCreateBaikeItem.json",e)},t.getDetail=function(e){return(0,r.default)("GET","/baike/person/edit/getDetail.json",e)},t.postEdit=function(e){return(0,r.default)("POST","/baike/person/edit/postEdit.json",e)},t.postEditRelated=function(e){return(0,r.default)("POST","/baike/person/edit/postEditRelated.json",e)}},7901:(e,t,n)=>{t.t=void 0;var i=n(56656);t.t=function(){var e=(0,i.useFormErrors)(),t=e.errors,n=e.wrapperValidate;return{errors:t,validateName:n("name")((function(e){if(""===e.trim())throw"请填写人物全名"})),validateDescription:n("description")((function(e){if(""===e.trim())throw"请填写人物简介"})),validateRelation:n("relation")((function(e){if(""===e.trim())throw"请填写关系"})),validateActivePeriod:n("activePeriod")((function(e){if(""===e.trim())throw"请填写活跃时期描述"}))}}},58628:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var i=n(66252),r=n(2262),a=n(81181),o=n(12861),l=n(42119),u=n(18037),d=n(73159),s=n(56400),c=n(56656),m=n(41269);const f="select--EkeQU",p=(0,i.aZ)({name:"PrioritySelector",props:{priority:{type:Number,default:0},subPriority:{type:Number,default:1}},setup:function(e,t){var n=t.emit,o=(0,r.reactive)({priority:e.priority,subPriority:e.subPriority});(0,i.YP)((function(){return o.priority}),(function(e){n("update:priority",e)})),(0,i.YP)((function(){return o.subPriority}),(function(e){n("update:subPriority",e)})),(0,i.YP)((function(){return e.priority}),(function(e){o.priority=e})),(0,i.YP)((function(){return e.subPriority}),(function(e){o.subPriority=e}));var l=[{value:0,text:"无优先级别"},{value:1,text:"一级优先"},{value:2,text:"二级优先"},{value:3,text:"三级优先"},{value:4,text:"四级优先"},{value:5,text:"五级优先"},{value:6,text:"六级优先"},{value:7,text:"七级优先"},{value:8,text:"八级优先"}],u=[{value:1,text:"初阶"},{value:2,text:"中阶"},{value:3,text:"高阶"},{value:4,text:"圆满"}];return function(){return(0,i.Wm)("div",{class:"selector--ckIdS"},[(0,i.Wm)(a.Select,{modelValue:o.priority,"onUpdate:modelValue":function(e){return o.priority=e},data:l,triggerClass:f},null),(0,i.Wm)(a.Select,{modelValue:o.subPriority,"onUpdate:modelValue":function(e){return o.subPriority=e},data:u,triggerClass:f},null)])}}});var v=n(88006),y=n(7901);const g="radio--VGAiI";function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const P=(0,i.aZ)({name:"BasicStep",setup:function(){var e=(0,l.useRoute)(),t=(0,r.reactive)({isLoading:!1,isBusy:!1,isEdit:!1}),n=(0,r.reactive)({indexID:0,name:"",displayName:"",englishName:"",avatarKey:"",gender:"male",priority:0,subPriority:1,description:"",summaryDescription:"",relationText:"",activePeriodText:"",viewGroup:-1,isPartInRank:!0,isPublic:!0});(0,i.bv)((function(){+e.params.id&&(t.isLoading=!0,(0,m.getDetail)({indexID:+e.params.id}).then((function(e){t.isEdit=!0,n.indexID=e.indexID,n.name=e.name,n.displayName=e.displayName,n.englishName=e.englishName,n.avatarKey=e.avatarKey,n.gender=e.gender?"male":"female",n.priority=e.priority,n.subPriority=e.subPriority,n.description=e.description,n.summaryDescription=e.summaryDescription,n.relationText=e.relationText,n.activePeriodText=e.activePeriodText,n.viewGroup=e.viewGroup,n.isPartInRank=!e.riskInRank,n.isPublic=e.isPublic})).catch((function(e){n.indexID=0,a.Notify.error(e)})).finally((function(){t.isLoading=!1})))}));var u=(0,y.t)(),f=u.errors,W=u.validateName,h=u.validateDescription,P=u.validateRelation,D=u.validateActivePeriod,k=function(){if(W(n.name),h(n.description),P(n.relationText),D(n.activePeriodText),f.size>0)(0,c.scrollToError)();else{var e={name:n.name,displayName:n.displayName,englishName:n.englishName,avatarKey:n.avatarKey,gender:"male"===n.gender?1:0,priority:n.priority,subPriority:n.subPriority,description:n.description,summaryDescription:n.summaryDescription,relationText:n.relationText,activePeriodText:n.activePeriodText,viewGroup:n.viewGroup,riskInRank:!n.isPartInRank,isPublic:n.isPublic};if(t.isEdit){var i=b(b({},e),{},{indexID:n.indexID});return t.isBusy=!0,void(0,m.postEdit)(i).then((function(){window.scrollTo({top:0,behavior:"smooth"}),o.router.push({name:o.RouteName.BAIKE_PERSON_EDIT_POSITION,params:{id:n.indexID}})})).catch((function(e){a.Notify.error(e)})).finally((function(){t.isBusy=!1}))}t.isBusy=!0,(0,m.postCreatePersonItem)(e).then((function(e){o.router.push({name:o.RouteName.BAIKE_PERSON_EDIT_POSITION,params:{id:e.indexID}})})).catch((function(e){a.Notify.error(e)})).finally((function(){t.isBusy=!1}))}};return function(){return(0,i.Wm)(a.Loading,{show:t.isLoading},{default:function(){return[(0,i.Wm)("div",{class:"basicStep--Wo99D"},[(0,i.Wm)(d.Z,{label:"人物全名：",errorDesc:f.get("name")},{default:function(){return[(0,i.Wm)(a.Input,{modelValue:n.name,"onUpdate:modelValue":function(e){return n.name=e},placeholder:"64 个字符之内(*)",maxlength:64,onValidate:W,block:!0},null)]}}),(0,i.Wm)(d.Z,{label:"百科头像："},{default:function(){return[(0,i.Wm)(s.Z,{tokenType:"baike",avatarSize:540,avatarKey:n.avatarKey,onSuccess:function(e){n.avatarKey=e.key}},null)]}}),(0,i.Wm)(d.Z,{label:"展示用花名："},{default:function(){return[(0,i.Wm)(a.Input,{modelValue:n.displayName,"onUpdate:modelValue":function(e){return n.displayName=e},placeholder:"64 个字符之内",maxlength:64,block:!0},null)]}}),(0,i.Wm)(d.Z,{label:"英文名："},{default:function(){return[(0,i.Wm)(a.Input,{modelValue:n.englishName,"onUpdate:modelValue":function(e){return n.englishName=e},placeholder:"64 个字符之内",maxlength:64,block:!0},null)]}}),(0,i.Wm)(d.Z,{label:"性别："},{default:function(){return[(0,i.Wm)("div",null,[(0,i.Wm)(a.Radio,{class:g,name:"gender",value:"male",modelValue:n.gender,"onUpdate:modelValue":function(e){return n.gender=e}},{default:function(){return[(0,i.Uk)("男")]}}),(0,i.Wm)(a.Radio,{class:g,name:"gender",value:"female",modelValue:n.gender,"onUpdate:modelValue":function(e){return n.gender=e}},{default:function(){return[(0,i.Uk)("女")]}})])]}}),(0,i.Wm)(d.Z,{label:"优先级别："},{default:function(){return[(0,i.Wm)(p,{priority:n.priority,"onUpdate:priority":function(e){return n.priority=e},subPriority:n.subPriority,"onUpdate:subPriority":function(e){return n.subPriority=e}},null)]}}),(0,i.Wm)(d.Z,{label:"人物简介：",errorDesc:f.get("description")},{default:function(){return[(0,i.Wm)(a.Textarea,{modelValue:n.description,"onUpdate:modelValue":function(e){return n.description=e},placeholder:"展示在百科页头的人物简介，1000字之内(*)",maxlength:1e3,height:"100px",block:!0,resize:"vertical",onValidate:h},null)]}}),(0,i.Wm)(d.Z,{label:"人物简介摘要："},{default:function(){return[(0,i.Wm)(a.Textarea,{modelValue:n.summaryDescription,"onUpdate:modelValue":function(e){return n.summaryDescription=e},placeholder:"展示在搜索结果的人物简介摘要，240字之内",maxlength:240,block:!0,resize:"none"},null)]}}),(0,i.Wm)(d.Z,{label:"与孙天骁的关系：",errorDesc:f.get("relation")},{default:function(){return[(0,i.Wm)(a.Input,{modelValue:n.relationText,"onUpdate:modelValue":function(e){return n.relationText=e},placeholder:"如：大学同学、同事等(*)",maxlength:32,onValidate:P,block:!0},null)]}}),(0,i.Wm)(d.Z,{label:"活跃时期描述：",errorDesc:f.get("activePeriod")},{default:function(){return[(0,i.Wm)(a.Input,{modelValue:n.activePeriodText,"onUpdate:modelValue":function(e){return n.activePeriodText=e},placeholder:"如：大学时期、高中时期等(*)",maxlength:32,onValidate:D,block:!0},null)]}}),(0,i.Wm)(d.Z,{label:"浏览权限："},{default:function(){return[(0,i.Wm)(v.Z,{modelValue:n.viewGroup,"onUpdate:modelValue":function(e){return n.viewGroup=e}},null)]}}),(0,i.Wm)(d.Z,{label:"参与百科排行计算：",row:!0},{default:function(){return[(0,i.Wm)(a.Switch,{modelValue:n.isPartInRank,"onUpdate:modelValue":function(e){return n.isPartInRank=e}},null)]}}),(0,i.Wm)(d.Z,{label:"公开该词条：",row:!0},{default:function(){return[(0,i.Wm)(a.Switch,{modelValue:n.isPublic,"onUpdate:modelValue":function(e){return n.isPublic=e}},null)]}}),(0,i.Wm)(d.Z,null,{default:function(){return[(0,i.Wm)("div",{class:"submit--xysW+"},[t.isEdit&&(0,i.Wm)(a.Button,{style:{marginRight:"8px"},onClick:function(){o.router.push({name:o.RouteName.BAIKE_PERSON_EDIT_POSITION,params:{id:+e.params.id}})}},{default:function(){return[(0,i.Uk)("跳过")]}}),(0,i.Wm)(a.Button,{type:"info",icon:"send",onClick:k,loading:t.isBusy},{default:function(){return[t.isEdit?"提交修改":"提交创建"]}})])]}})])]}})}}});var D=n(82298),k=n(39465),I=n(56132),x=n(82287),U=n(52596),N=n(6918);const B=(0,i.aZ)({name:"UserSelector",props:{modelValue:Boolean,selected:String,onConfirm:Function},setup:function(e,t){var n=t.emit,o=(0,r.reactive)({showDialog:e.modelValue||!1,list:[],loading:!1,selected:e.selected,keyWord:""}),l=(0,r.reactive)({list:(0,i.Fl)((function(){var e=o.keyWord.split(" ").filter(Boolean).map((function(e){return e.toLowerCase()}));return 0===e.length?o.list.slice(0,12):o.list.filter((function(t){var n="".concat(t.name," ").concat(t.realName," ").concat(t.alias).toLowerCase();return e.every((function(e){return n.includes(e)}))})).slice(0,12)}))});return(0,i.YP)((function(){return e.modelValue}),(function(e){o.showDialog=e})),(0,i.YP)((function(){return o.showDialog}),(function(t){e.modelValue!==t&&n("update:modelValue",t),o.loading=!0,(0,N.getData)().then((function(e){o.list=e.list})).catch((function(e){a.Notify.error(e)})).finally((function(){o.loading=!1}))}),{immediate:!0}),function(){return(0,i.Wm)(a.Dialog,{style:{width:"660px"},stickTop:!0,modelValue:o.showDialog,"onUpdate:modelValue":function(e){return o.showDialog=e},title:"选择用户"},{default:function(){return[(0,i.Wm)("div",null,[(0,i.Wm)(a.Input,{modelValue:o.keyWord,"onUpdate:modelValue":function(e){return o.keyWord=e},placeholder:"输入关键字进行匹配查找…",block:!0,autofocus:!0},null)]),(0,i.Wm)("div",{class:"content--Sj1Rk"},[l.list.length>0&&(0,i.Wm)("div",{class:"list--Mbcf0"},[l.list.map((function(e){return(0,i.Wm)("div",{key:e.id,class:["item--UvqUi",(t={},n="selected--EkIMu",r=e.code===o.selected,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t)],onClick:function(){o.selected=e.code}},[(0,i.Wm)("div",{class:"avatar--CPLOZ"},[(0,i.Wm)("img",{src:(0,u.fullfillImage)(e.avatarKey),alt:""},null)]),(0,i.Wm)("div",{class:"info--Z19Xe"},[(0,i.Wm)("div",{class:"name--ZBL3O"},[e.name]),(0,i.Wm)("div",{class:"join--J0hyd"},[e.createdAt,(0,i.Uk)(" 加入")])]),(0,i.Wm)("span",{class:"ide--YREEQ"},[(0,i.Wm)(a.Icon,{type:"ok"},null)])]);var t,n,r})),new Array(l.list.length%3).fill(0).map((function(e,t){return(0,i.Wm)("div",{key:t,class:"itemHold--B1uqx"},null)}))]),0===l.list.length&&(0,i.Wm)("div",{class:"emptyTip--do5zq"},[(0,i.Uk)("暂无匹配用户")])]),(0,i.Wm)("div",{class:"footer--P4pwp"},[(0,i.Wm)(a.Button,{type:"primary",icon:"ok",onClick:function(){var t;null===(t=e.onConfirm)||void 0===t||t.call(e,o.selected||""),o.showDialog=!1}},{default:function(){return[(0,i.Uk)("确定")]}})])]}})}}}),w=(0,i.aZ)({name:"BindUserEditor",props:{indexID:{type:Number,required:!0}},setup:function(e){var t=(0,r.reactive)({showDialog:!1,bindUser:null}),n=function(){(0,U.getBindUserByIndexID)({indexID:e.indexID}).then((function(e){e.exists?t.bindUser={name:e.user.name,code:e.user.code}:t.bindUser=null}))};(0,i.YP)((function(){return e.indexID}),n,{immediate:!0});var o=function(t){(0,U.postBindUser)({indexID:e.indexID,userCode:t}).then((function(){a.Notify.success("操作成功"),n()})).catch((function(e){a.Notify.error(e)}))},l=function(){a.SweetAlert.confirm({content:"你确定要将该人物百科与用户解绑？",onConfirm:function(){return(0,U.postBindUser)({indexID:e.indexID,userCode:""}).then((function(){a.Notify.success("已解绑"),t.bindUser=null})).catch((function(e){a.Notify.error(e)}))}})};return function(){return(0,i.Wm)("div",{class:"editor--voDiC"},[(0,i.Wm)("div",null,[(0,i.Wm)(a.Button,{size:"small",icon:"thing",onClick:function(){t.showDialog=!0}},{default:function(){return[(0,i.Uk)("选择用户")]}})]),t.bindUser&&(0,i.Wm)("div",{class:"selected--BQGIh"},[(0,i.Uk)("已选择用户："),(0,i.Wm)(x.Z,{userName:t.bindUser.name,userCode:t.bindUser.code},null),(0,i.Wm)("a",{class:"unbind--y7MRg",onClick:l},[(0,i.Uk)("解绑")])]),(0,i.Wm)(B,{onConfirm:o,modelValue:t.showDialog,"onUpdate:modelValue":function(e){return t.showDialog=e}},null)])}}});var V=n(89090);const E=(0,i.aZ)({name:"PositionStep",setup:function(){var e=(0,l.useRoute)(),t=(0,r.ref)(),n=(0,r.reactive)({loading:!1,detail:null});return(0,i.m0)((function(){n.loading=!0;var t=+e.params.id;t&&(0,m.getDetail)({indexID:t}).then((function(e){n.detail=e})).catch((function(e){a.Notify.error(e)})).finally((function(){n.loading=!1}))})),function(){return(0,i.Wm)(a.Loading,{show:n.loading},{default:function(){return[(0,i.Wm)("div",{class:"positionStep--P7VaL"},[(0,i.Wm)(d.Z,null,{default:function(){return[(0,i.Wm)("div",{class:"title--PS0xP"},[(0,i.Uk)("百科人物："),n.detail?(0,V.HW)(n.detail.displayName,n.detail.name):"-"])]}}),(0,i.Wm)(d.Z,{label:"关联入口链接："},{default:function(){return[(0,i.Wm)(k.Z,{ref:t,indexID:+e.params.id},null)]}}),(0,i.Wm)(d.Z,{label:"关联关键词："},{default:function(){return[(0,i.Wm)(D.Z,{indexID:+e.params.id},null)]}}),(0,i.Wm)(d.Z,{label:"关联文章："},{default:function(){return[(0,i.Wm)(I.Z,{indexID:+e.params.id},null)]}}),(0,i.Wm)(d.Z,{label:"关联用户："},{default:function(){return[(0,i.Wm)(w,{indexID:+e.params.id},null)]}}),(0,i.Wm)(d.Z,null,{default:function(){return[(0,i.Wm)("div",{class:"submit--wafnr"},[(0,i.Wm)(a.Button,{style:{marginRight:"8px"},onClick:function(){o.router.push({name:o.RouteName.BAIKE_PERSON_EDIT_BASIC,params:{id:+e.params.id}})}},{default:function(){return[(0,i.Uk)("上一步")]}}),(0,i.Wm)(a.Button,{style:{marginRight:"8px"},onClick:function(){o.router.push({name:o.RouteName.BAIKE_PERSON_EDIT_RELATED,params:{id:+e.params.id}})}},{default:function(){return[(0,i.Uk)("下一步")]}})])]}})])]}})}}});var S=n(9881),R=n(76759);const O=(0,i.aZ)({name:"RelatedStep",setup:function(e){var t=(0,l.useRoute)(),n=(0,r.reactive)({loading:!1,detail:null,relation:[],related:[],isBusy:!1});(0,i.m0)((function(){n.loading=!0;var e=+t.params.id;e&&(0,m.getDetail)({indexID:e,step:3}).then((function(e){n.detail=e,n.relation=n.detail.relation||[],n.related=n.detail.related||[]})).catch((function(e){a.Notify.error(e)})).finally((function(){n.loading=!1}))}));var u=function(){if(n.relation.length>0&&n.relation.some((function(e){return!e.relation||""===e.relation.trim()})))return a.Notify.info("关系未填写完整"),Promise.reject();var e=n.relation.map((function(e){return{indexID:e.indexID,relation:e.relation}})),i=n.related.map((function(e){return e.indexID})),r=+t.params.id;return n.isBusy=!0,(0,m.postEditRelated)({indexID:r,relations:e,relatedIds:i}).then((function(){a.Notify.success("保存成功")})).catch((function(e){return a.Notify.error(e),Promise.reject()})).finally((function(){n.isBusy=!1}))},s=function(){u().then((function(){var e,i;o.router.push(null!==(e=null===(i=n.detail)||void 0===i?void 0:i.url)&&void 0!==e?e:"/v2/baike/".concat(t.params.id))}))};return function(){return(0,i.Wm)(a.Loading,{style:{height:"100%"},show:n.loading},{default:function(){return[(0,i.Wm)("div",{class:"relatedStep--iaC2R"},[(0,i.Wm)("div",null,[(0,i.Wm)(d.Z,null,{default:function(){return[(0,i.Wm)("div",{class:"title--BqHp5"},[(0,i.Uk)("百科人物："),n.detail?(0,V.HW)(n.detail.displayName,n.detail.name):"-"])]}}),(0,i.Wm)(d.Z,{label:"关联百科："},{default:function(){return[(0,i.Wm)(R.Z,{data:n.relation,"onUpdate:data":function(e){return n.relation=e}},null)]}}),(0,i.Wm)(d.Z,{label:"相关百科条目："},{default:function(){return[(0,i.Wm)(S.Z,{data:n.related,"onUpdate:data":function(e){return n.related=e}},null)]}})]),(0,i.Wm)("div",{class:"submit--Ky52f"},[(0,i.Wm)(a.Button,{onClick:function(){o.router.push({name:o.RouteName.BAIKE_PERSON_EDIT_POSITION,params:{id:+t.params.id}})},style:{marginRight:"8px"}},{default:function(){return[(0,i.Uk)("上一步")]}}),(0,i.Wm)(a.Button,{type:"default",onClick:u,loading:n.isBusy,style:{marginRight:"8px"}},{default:function(){return[(0,i.Uk)("仅保存")]}}),(0,i.Wm)(a.Button,{icon:"ok",type:"primary",onClick:s,loading:n.isBusy},{default:function(){return[(0,i.Uk)("保存并查看百科")]}})])])]}})}}}),T=(0,i.aZ)({name:"BaikePersonCreate",setup:function(){var e=(0,l.useRoute)(),t=!!+e.params.id;(0,u.setPageTitle)(t?"编辑人物词条":"新建人物词条");var n=(0,r.reactive)({baikeID:0,currentStep:(0,i.Fl)((function(){return o.router.currentRoute.value.meta.step||0}))});return function(){return(0,i.Wm)("div",{class:["s-container","container--Jrs62"]},[(0,i.Wm)("aside",{class:"steps--KezFR"},[(0,i.Wm)(a.Steps,{current:n.currentStep,direction:"vertical"},{default:function(){return[(0,i.Wm)(a.Step,{title:"第一步",description:"填写基本信息"},null),(0,i.Wm)(a.Step,{title:"第二步",description:"关联有关信息"},null),(0,i.Wm)(a.Step,{title:"第三步",description:"关联其他百科"},null)]}})]),(0,i.Wm)("main",{class:"main--l8g4k"},[0===n.currentStep&&(0,i.Wm)(P,null,null),1===n.currentStep&&(0,i.Wm)(E,null,null),2===n.currentStep&&(0,i.Wm)(O,null,null)]),(0,i.Wm)("aside",{class:"aside--8gWjV"},[(0,i.Wm)("h2",null,[t?"编辑人物词条":"新建人物词条"]),(0,i.Wm)("p",null,[(0,i.Uk)("人物词条含有非公众人物和公众人物。不包含动漫、小说、游戏中的虚拟人物。")]),e.params.id&&(0,i.Wm)("div",null,[(0,i.Wm)(a.Button,{icon:"view",href:"/v2/baike/go?id=".concat(e.params.id),target:"_blank",rel:"opener"},{default:function(){return[(0,i.Uk)("查看百科页")]}})])])])}}})}}]);
//# sourceMappingURL=832.61de60.js.map